<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css" integrity="sha256-2H3fkXt6FEmrReK448mDVGKb3WW2ZZw35gI7vqHOE4Y=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"pickteemo.github.io","root":"/","images":"/images","scheme":"Gemini","version":"8.7.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>
<meta name="description" content="(tinyfsm usage)[https:&#x2F;&#x2F;digint.ch&#x2F;tinyfsm&#x2F;doc&#x2F;usage.html] USAGE Refer to the API examples: &#x2F;examples&#x2F;api&#x2F; provided with the TinyFSM package for a quick overview. Recommended starting points:  Simple S">
<meta property="og:type" content="article">
<meta property="og:title" content="tinyfsm">
<meta property="og:url" content="https://pickteemo.github.io/2021/03/19/note/tinyfsm/index.html">
<meta property="og:site_name">
<meta property="og:description" content="(tinyfsm usage)[https:&#x2F;&#x2F;digint.ch&#x2F;tinyfsm&#x2F;doc&#x2F;usage.html] USAGE Refer to the API examples: &#x2F;examples&#x2F;api&#x2F; provided with the TinyFSM package for a quick overview. Recommended starting points:  Simple S">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2021-03-19T01:16:18.000Z">
<meta property="article:modified_time" content="2021-07-14T04:08:21.778Z">
<meta property="article:author" content="Tahm Kench">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://pickteemo.github.io/2021/03/19/note/tinyfsm/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://pickteemo.github.io/2021/03/19/note/tinyfsm/","path":"2021/03/19/note/tinyfsm/","title":"tinyfsm"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>tinyfsm | </title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title"></h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#usage"><span class="nav-number">1.</span> <span class="nav-text">USAGE</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#declare-events"><span class="nav-number">1.0.1.</span> <span class="nav-text">1. Declare Events</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#declare-the-state-machine-class"><span class="nav-number">1.0.2.</span> <span class="nav-text">2. Declare the State Machine Class</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#declare-the-states"><span class="nav-number">1.0.3.</span> <span class="nav-text">3. Declare the States</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#implement-actions-and-event-reactions"><span class="nav-number">1.0.4.</span> <span class="nav-text">4. Implement Actions and Event Reactions</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#define-the-initial-state"><span class="nav-number">1.0.5.</span> <span class="nav-text">5. Define the Initial State</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#define-custom-initialization"><span class="nav-number">1.0.6.</span> <span class="nav-text">6. Define Custom Initialization</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#use-fsmlist-for-event-dispatching"><span class="nav-number">1.0.7.</span> <span class="nav-text">7. Use FsmList for Event Dispatching</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-overview">
            <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Tahm Kench</p>
  <div class="site-description" itemprop="description">the River King</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">36</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="mailto:pppickteemo@gmail.com" title="E-Mail â†’ mailto:pppickteemo@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>
  <div class="cc-license site-overview-item animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdn.jsdelivr.net/npm/@creativecommons/vocabulary@2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>



          </div>
        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://pickteemo.github.io/2021/03/19/note/tinyfsm/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Tahm Kench">
      <meta itemprop="description" content="the River King">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          tinyfsm
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-03-19 09:16:18" itemprop="dateCreated datePublished" datetime="2021-03-19T09:16:18+08:00">2021-03-19</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-07-14 12:08:21" itemprop="dateModified" datetime="2021-07-14T12:08:21+08:00">2021-07-14</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>(tinyfsm usage)[https://digint.ch/tinyfsm/doc/usage.html]</p>
<h1 id="usage">USAGE</h1>
<p>Refer to the API examples: <code>/examples/api/</code> provided with the TinyFSM package for a quick overview. Recommended starting points:</p>
<ul>
<li>Simple Switch: <code>/examples/api/simple_switch.cpp</code></li>
<li>Moore Machine: <code>/examples/api/moore_machine.cpp</code></li>
<li>Elevator Project: <code>/examples/elevator/</code></li>
</ul>
<p>For an example in an RTOS environment, see the <a target="_blank" rel="noopener" href="https://github.com/digint/openmptl/tree/master/projects/stm32f103stk-demo">stm32f103stk-demo</a> of the <a target="_blank" rel="noopener" href="https://digint.ch/openmptl/">OpenMPTL</a> project. Starting points:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/digint/openmptl/tree/master/projects/stm32f103stk-demo/src/screen.hpp">screen.hpp</a> : TinyFSM declarations.</li>
<li><a target="_blank" rel="noopener" href="https://github.com/digint/openmptl/tree/master/projects/stm32f103stk-demo/src/kernel.cpp">kernel.cpp</a> : Poll input and trigger events.</li>
</ul>
<p>The examples in the documentation below are mainly based on the "Elevator Project" example.</p>
<span id="more"></span>
<h3 id="declare-events">1. Declare Events</h3>
<p>Declare events that your state machine will listen to. Events are classes derived from the tinyfsm::Event class.</p>
<p>Example:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">FloorEvent</span> :</span> tinyfsm::Event</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">int</span> <span class="built_in">floor</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Call</span>        :</span> FloorEvent &#123; &#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">FloorSensor</span> :</span> FloorEvent &#123; &#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Alarm</span>       :</span> tinyfsm::Event &#123; &#125;;</span><br></pre></td></tr></table></figure>
<p>In the example above, we declare three events. Note that events are regular classes, which are passed as arguments to the react() members of a state class. In this example, we use a member variable "floor", which is used to specify the floor number on "Call" and "FloorSensors" events.</p>
<h3 id="declare-the-state-machine-class">2. Declare the State Machine Class</h3>
<p>Declare your state machine class. State machines are classes derived from the tinyfsm::Fsm template class, where T is the type name of the state machine itself.</p>
<p>You need to declare the following public members:</p>
<ul>
<li>react() function for each event</li>
<li>entry() and exit() functions</li>
</ul>
<p>Example:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Elevator</span></span></span><br><span class="line"><span class="class">:</span> <span class="keyword">public</span> tinyfsm::Fsm&lt;Elevator&gt;</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="comment">/* default reaction for unhandled events */</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">react</span><span class="params">(tinyfsm::Event <span class="keyword">const</span> &amp;)</span> </span>&#123; &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">react</span><span class="params">(Call        <span class="keyword">const</span> &amp;)</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">react</span><span class="params">(FloorSensor <span class="keyword">const</span> &amp;)</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">void</span>         <span class="title">react</span><span class="params">(Alarm       <span class="keyword">const</span> &amp;)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">entry</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123; &#125;;  <span class="comment">/* entry actions in some states */</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span>         <span class="title">exit</span><span class="params">(<span class="keyword">void</span>)</span>  </span>&#123; &#125;;  <span class="comment">/* no exit actions */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>Note that you are free to declare the functions non-virtual if you like. This has implications on the execution speed: In the example above, the react(Alarm) function is declared non-virtual, as all states share the same reaction for this event. This makes code execution faster when dispatching the "Alarm" event, since no vtable lookup is needed.</p>
<h3 id="declare-the-states">3. Declare the States</h3>
<p>Declare the states of your state machine. States are classes derived from the state machine class.</p>
<p>Note that state classes are <em>implicitly instantiated</em>. If you want to reuse states in multiple state machines, you need to declare them as templates (see <code>/examples/api/multiple_switch.cpp</code>).</p>
<p>Example:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Panic</span></span></span><br><span class="line"><span class="class">:</span> <span class="keyword">public</span> Elevator</span><br><span class="line">&#123;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">entry</span><span class="params">()</span> <span class="keyword">override</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Moving</span></span></span><br><span class="line"><span class="class">:</span> <span class="keyword">public</span> Elevator</span><br><span class="line">&#123;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">react</span><span class="params">(FloorSensor <span class="keyword">const</span> &amp;)</span> <span class="keyword">override</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Idle</span></span></span><br><span class="line"><span class="class">:</span> <span class="keyword">public</span> Elevator</span><br><span class="line">&#123;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">entry</span><span class="params">()</span> <span class="keyword">override</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">react</span><span class="params">(Call <span class="keyword">const</span> &amp; e)</span> <span class="keyword">override</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>In this example, we declare three states. Note that the "elevator" example source code does not declare the states separately, but rather defines the code directly in the declaration.</p>
<h3 id="implement-actions-and-event-reactions">4. Implement Actions and Event Reactions</h3>
<p>In most cases, event reactions consist of one or more of the following steps:</p>
<ul>
<li>Change some local data</li>
<li>Send events to other state machines</li>
<li>Transit to different state</li>
</ul>
<p><strong>Important</strong>: Make sure that the <code>transit&lt;&gt;()</code> function call is the last command executed within a reaction function!</p>
<p><strong>Important</strong>: Don't use <code>transit&lt;&gt;()</code> in entry/exit actions!</p>
<p>Example:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Idle::entry</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  send_event(MotorStop());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Idle::react</span><span class="params">(Call <span class="keyword">const</span> &amp; e)</span> </span>&#123;</span><br><span class="line">  dest_floor = e.<span class="built_in">floor</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(dest_floor == current_floor)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* lambda function used for transition action */</span></span><br><span class="line">  <span class="keyword">auto</span> action = [] &#123; </span><br><span class="line">    <span class="keyword">if</span>(dest_floor &gt; current_floor)</span><br><span class="line">      send_event(MotorUp());</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(dest_floor &lt; current_floor)</span><br><span class="line">      send_event(MotorDown());</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  transit&lt;Moving&gt;(action);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>In this</p>
<p>example, we use a lambda function as transition action. The <code>transit&lt;&gt;()</code> function does the following:</p>
<ol type="1">
<li>Call the exit() function of the current state</li>
<li>Call the the transition action if provided</li>
<li>Change the current state to the new state</li>
<li>Call the entry() function of the new state</li>
</ol>
<p>Note that you can also pass condition functions to the <code>transit&lt;&gt;()</code> function.</p>
<h3 id="define-the-initial-state">5. Define the Initial State</h3>
<p>Use the macro <code>FSM_INITIAL_STATE(fsm, state)</code> for defining the initial state (or "start state") of your state machine:</p>
<p>Example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FSM_INITIAL_STATE(Elevator, Idle)</span><br></pre></td></tr></table></figure>
<p>This sets the current state of the "Elevator" state machine to "Idle". More specifially, it defines a template specialization for <code>Fsm&lt;Elevator&gt;::set_initial_state()</code>, setting the current state to Idle.</p>
<h3 id="define-custom-initialization">6. Define Custom Initialization</h3>
<p>If you need to perform custom initialization, you can override the reset() member function in your state machine class. If you are using state variables, you can re-instantiate your states by calling <code>tinyfsm::StateList&lt;MyStates...&gt;::reset()</code>.</p>
<p>Example:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Switch</span> :</span> <span class="keyword">public</span> tinyfsm::Fsm&lt;Switch&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">public</span>: <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">reset</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">    tinyfsm::StateList&lt;Off, On&gt;::reset();  <span class="comment">// reset all states</span></span><br><span class="line">    myvar = <span class="number">0</span>;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Make sure to always set the current state, or you'll end up with a null pointer dereference.</p>
<h3 id="use-fsmlist-for-event-dispatching">7. Use FsmList for Event Dispatching</h3>
<p>You might have noticed some calls to a send_event() function in the example above. This is NOT a function provided with TinyFSM. Since event dispatching can be implemented in several ways, TinyFSM leaves this open to you. The "elevator" example implements the send_event() function as <em>direct event dispatching</em>, without using event queues. This has the advantage that execution is much faster, since no RTTI is needed and the decision which function to call for an event class is made at compile-time. On the other hand, special care has to be taken when designing the state machines, in order to avoid loops.</p>
<p>Code from "fsmlist.hpp":</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> tinyfsm::FsmList&lt;Motor, Elevator&gt; fsm_list;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> E&gt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">send_event</span><span class="params">(E <span class="keyword">const</span> &amp; event)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  fsm_list::<span class="keyword">template</span> dispatch&lt;E&gt;(event);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Here, send_event() dispatches events to all state machines in the list. It is important to understand that this approach comes with no performance penalties at all, as long as the default reaction is defined empty within the state machine declaration.</p>

    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>Post author:  </strong>Tahm Kench
  </li>
  <li class="post-copyright-link">
      <strong>Post link: </strong>
      <a href="https://pickteemo.github.io/2021/03/19/note/tinyfsm/" title="tinyfsm">https://pickteemo.github.io/2021/03/19/note/tinyfsm/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> unless stating additionally.
  </li>
</ul>
</div>


        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2021/03/18/apollo/planning/1_12_speed_decider/" rel="prev" title="1.12 Speed Decider">
                  <i class="fa fa-chevron-left"></i> 1.12 Speed Decider
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2021/03/19/note/cpp-cheet-sheets/" rel="next" title="cpp_cheet_sheets">
                  cpp_cheet_sheets <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Tahm Kench</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  




  




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":"all","tags":"none","js":{"url":"https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js","integrity":"sha256-r+3itOMtGGjap0x+10hu6jW/gZCzxHsoKrOd7gyRSGY="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
